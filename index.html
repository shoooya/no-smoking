<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦ç…™ã‚µãƒãƒ¼ãƒˆ - ã‚ãªãŸã®å¥åº·ã¨æœªæ¥ã®ãŸã‚ã«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .setup-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .setup-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-top: 10px;
        }

        #shareBtn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            margin-bottom: 10px;
        }

        #shareBtn:hover {
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .dashboard {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stat-label {
            color: #888;
            font-size: 0.9em;
        }

        .milestones-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .milestones-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .milestone {
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            border-left: 5px solid #e0e0e0;
            background: #f8f9fa;
            transition: all 0.3s;
            position: relative;
        }

        .milestone.achieved {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-left-color: #28a745;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }

        .milestone.next {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffe8a1 100%);
        }

        .milestone.upcoming {
            border-left-color: #ccc;
            background: #ffffff;
            opacity: 0.9;
        }

        .milestone-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .milestone.achieved .milestone-status {
            background: #28a745;
            color: white;
        }

        .milestone.next .milestone-status {
            background: #ffc107;
            color: #333;
        }

        .milestone.upcoming .milestone-status {
            background: #e0e0e0;
            color: #666;
        }

        .milestone-time {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .milestone-benefit {
            color: #555;
            line-height: 1.6;
        }

        .milestone-remaining {
            margin-top: 8px;
            color: #888;
            font-size: 0.9em;
            font-style: italic;
        }

        .milestone-icon {
            float: right;
            font-size: 1.5em;
        }

        .achievements-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .achievements-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .badge {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: #f8f9fa;
            opacity: 0.4;
            transition: all 0.3s;
        }

        .badge.earned {
            opacity: 1;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            transform: scale(1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .badge-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .badge-name {
            font-weight: 600;
            font-size: 0.9em;
        }

        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .progress-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .progress-item {
            margin-bottom: 25px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }

        .motivation-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .motivation-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .motivation-card p {
            font-size: 1.1em;
            line-height: 1.6;
            opacity: 0.95;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .badges-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        .timer-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .timer-display h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .timer-value {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .timer-segments {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .timer-segment {
            text-align: center;
        }

        .timer-segment-value {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }

        .timer-segment-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* ç¦ç…™ç¶™ç¶šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆGitHubé¢¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰ */
        .calendar-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .calendar-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .calendar-heatmap {
            display: flex;
            gap: 3px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .calendar-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .calendar-day {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            background: #ebedf0;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .calendar-day.future {
            background: #f8f9fa;
            border: 1px dashed #e0e0e0;
        }

        .calendar-day.success-light {
            background: #84fab0;
        }

        .calendar-day.success-perfect {
            background: #28a745;
        }

        .calendar-day.has-craving {
            background: #ffc107;
        }

        .calendar-day.slip {
            background: #dc3545;
        }

        .calendar-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.85em;
            color: #666;
        }

        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .calendar-legend-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .calendar-day {
                width: 12px;
                height: 12px;
            }

            .calendar-heatmap {
                gap: 2px;
            }

            .calendar-week {
                gap: 2px;
            }
        }

        /* æ¸‡æœ›è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ  */
        .fab-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(245, 87, 108, 0.5);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(245, 87, 108, 0.7);
        }

        .fab-button:active {
            transform: scale(0.95);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 1.5em;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: #333;
        }

        .intensity-slider-container {
            margin: 20px 0;
        }

        .intensity-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #84fab0 0%, #ffc107 50%, #dc3545 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .intensity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .intensity-value {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .radio-option {
            flex: 1;
            min-width: 100px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .radio-option label:hover {
            border-color: #667eea;
        }

        .cravings-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .cravings-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .craving-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #f5576c;
        }

        .craving-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .craving-time {
            font-weight: bold;
            color: #667eea;
        }

        .craving-intensity {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .craving-details {
            color: #555;
            line-height: 1.6;
        }

        .craving-details strong {
            color: #333;
        }

        .craving-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .craving-stat-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .craving-stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .craving-stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .fab-button {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }

            .modal-content {
                padding: 20px;
            }

            .radio-option {
                min-width: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš­ ç¦ç…™ã‚µãƒãƒ¼ãƒˆ</h1>
            <p>ã‚ãªãŸã®å¥åº·ã¨æœªæ¥ã®ãŸã‚ã«</p>
        </header>

        <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ -->
        <div id="setup" class="setup-card">
            <h2>ç¦ç…™ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</h2>
            <form id="setupForm">
                <div class="form-group">
                    <label for="quitDate">ç¦ç…™é–‹å§‹æ—¥æ™‚</label>
                    <input type="datetime-local" id="quitDate" required>
                </div>
                <div class="form-group">
                    <label for="cigarettesPerDay">1æ—¥ã‚ãŸã‚Šã®å–«ç…™æœ¬æ•°</label>
                    <input type="number" id="cigarettesPerDay" min="1" value="20" required>
                </div>
                <div class="form-group">
                    <label for="pricePerPack">1ç®±ã®ä¾¡æ ¼ï¼ˆå††ï¼‰</label>
                    <input type="number" id="pricePerPack" min="1" value="600" required>
                </div>
                <div class="form-group">
                    <label for="cigarettesPerPack">1ç®±ã‚ãŸã‚Šã®æœ¬æ•°</label>
                    <input type="number" id="cigarettesPerPack" min="1" value="20" required>
                </div>
                <button type="submit" class="btn">ç¦ç…™ã‚’é–‹å§‹ã™ã‚‹</button>
            </form>
        </div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div id="dashboard" class="dashboard">
            <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
            <div class="timer-display">
                <h2>ç¦ç…™ç¶™ç¶šæ™‚é–“</h2>
                <div class="timer-segments">
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="days">0</span>
                        <span class="timer-segment-label">æ—¥</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="hours">0</span>
                        <span class="timer-segment-label">æ™‚é–“</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="minutes">0</span>
                        <span class="timer-segment-label">åˆ†</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="seconds">0</span>
                        <span class="timer-segment-label">ç§’</span>
                    </div>
                </div>
            </div>

            <!-- ç¦ç…™ç¶™ç¶šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
            <div class="calendar-card">
                <h2>ç¦ç…™ç¶™ç¶šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
                <div id="calendarHeatmap" class="calendar-heatmap"></div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #f8f9fa; border: 1px dashed #e0e0e0;"></div>
                        <span>æœªåˆ°é”</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #84fab0;"></div>
                        <span>ç¶™ç¶šä¸­</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #28a745;"></div>
                        <span>å®Œç’§ãª1æ—¥</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #ffc107;"></div>
                        <span>æ¸‡æœ›ã‚ã‚Š</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #dc3545;"></div>
                        <span>ã‚¹ãƒªãƒƒãƒ—</span>
                    </div>
                </div>
            </div>
            <div class="calendar-tooltip" id="calendarTooltip"></div>

            <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-value" id="moneySaved">Â¥0</div>
                    <div class="stat-label">ç¯€ç´„ã—ãŸé‡‘é¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸš¬</div>
                    <div class="stat-value" id="cigarettesAvoided">0</div>
                    <div class="stat-label">å¸ã‚ãªã‹ã£ãŸã‚¿ãƒã‚³</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-value" id="lifeRegained">0</div>
                    <div class="stat-label">å–ã‚Šæˆ»ã—ãŸæ™‚é–“ï¼ˆåˆ†ï¼‰</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â¤ï¸</div>
                    <div class="stat-value" id="healthScore">0%</div>
                    <div class="stat-label">å¥åº·å›å¾©åº¦</div>
                </div>
            </div>

            <!-- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div class="motivation-card">
                <h3>ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
                <p id="motivationText">ç´ æ™´ã‚‰ã—ã„ï¼ç¦ç…™ã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚ä¸€æ—¥ä¸€æ—¥ãŒã‚ãªãŸã®å‹åˆ©ã§ã™ï¼</p>
            </div>

            <!-- å¥åº·ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ -->
            <div class="milestones-card">
                <h2>å¥åº·ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h2>
                <div id="milestones"></div>
            </div>

            <!-- é€²æ—çŠ¶æ³ -->
            <div class="progress-card">
                <h2>ç›®æ¨™ã¾ã§ã®é€²æ—</h2>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1é€±é–“é”æˆ</span>
                        <span id="week1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week1Bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1ãƒ¶æœˆé”æˆ</span>
                        <span id="month1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="month1Bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1å¹´é”æˆ</span>
                        <span id="year1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="year1Bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- é”æˆãƒãƒƒã‚¸ -->
            <div class="achievements-card">
                <h2>é”æˆãƒãƒƒã‚¸</h2>
                <div class="badges-grid" id="badges"></div>
            </div>

            <!-- æ¸‡æœ›è¨˜éŒ²ä¸€è¦§ -->
            <div class="cravings-card">
                <h2>æ¸‡æœ›è¨˜éŒ²</h2>
                <div class="craving-stats" id="cravingStats">
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="totalCravings">0</div>
                        <div class="craving-stat-label">ç·æ¸‡æœ›å›æ•°</div>
                    </div>
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="avgIntensity">0</div>
                        <div class="craving-stat-label">å¹³å‡å¼·åº¦</div>
                    </div>
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="todayCravings">0</div>
                        <div class="craving-stat-label">ä»Šæ—¥ã®æ¸‡æœ›</div>
                    </div>
                </div>
                <div id="cravingsList"></div>
            </div>

            <button class="btn" id="shareBtn">ğŸ”— é€²æ—ã‚’å…±æœ‰ã™ã‚‹URLã‚’ã‚³ãƒ”ãƒ¼</button>
            <button class="btn btn-secondary" id="resetBtn">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <!-- æ¸‡æœ›è¨˜éŒ²FABãƒœã‚¿ãƒ³ -->
    <button class="fab-button hidden" id="cravingFab" title="å¸ã„ãŸããªã£ãŸ">ğŸš¬</button>

    <!-- æ¸‡æœ›è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="cravingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ¸‡æœ›ã‚’è¨˜éŒ²</h2>
                <button class="modal-close" id="closeCravingModal">Ã—</button>
            </div>
            <form id="cravingForm">
                <div class="form-group">
                    <label>æ¸‡æœ›ã®å¼·ã•ï¼ˆ1-10ï¼‰</label>
                    <div class="intensity-slider-container">
                        <input type="range" class="intensity-slider" id="intensitySlider" min="1" max="10" value="5">
                        <div class="intensity-value" id="intensityValue">5</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>çŠ¶æ³</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="sit1" name="situation" value="ä»•äº‹ä¸­" checked>
                            <label for="sit1">ä»•äº‹ä¸­</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit2" name="situation" value="é£Ÿå¾Œ">
                            <label for="sit2">é£Ÿå¾Œ</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit3" name="situation" value="é£²é…’æ™‚">
                            <label for="sit3">é£²é…’æ™‚</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit4" name="situation" value="ã‚¹ãƒˆãƒ¬ã‚¹">
                            <label for="sit4">ã‚¹ãƒˆãƒ¬ã‚¹</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit5" name="situation" value="ãã®ä»–">
                            <label for="sit5">ãã®ä»–</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cravingTrigger">ãƒˆãƒªã‚¬ãƒ¼</label>
                    <input type="text" id="cravingTrigger" placeholder="ä½•ãŒãã£ã‹ã‘ã§ã™ã‹ï¼Ÿ">
                </div>

                <div class="form-group">
                    <label for="cravingNotes">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
                    <input type="text" id="cravingNotes" placeholder="æ°—æŒã¡ã‚„çŠ¶æ³ã‚’è¨˜éŒ²...">
                </div>

                <button type="submit" class="btn">è¨˜éŒ²ã™ã‚‹</button>
            </form>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let quitData = null;
        let updateInterval = null;
        let calendarData = {};
        let cravings = [];

        // å¥åº·ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ï¼ˆåŒ»å­¦çš„æ ¹æ‹ ã«åŸºã¥ãï¼‰
        const healthMilestones = [
            { minutes: 20, text: 'è¡€åœ§ã¨è„ˆæ‹ãŒæ­£å¸¸å€¤ã«æˆ»ã‚Šå§‹ã‚ã¾ã™', icon: 'â¤ï¸' },
            { minutes: 480, text: 'è¡€ä¸­ã®ä¸€é…¸åŒ–ç‚­ç´ æ¿ƒåº¦ãŒæ­£å¸¸å€¤ã«æˆ»ã‚Šã¾ã™', icon: 'ğŸ«' },
            { minutes: 1440, text: 'å¿ƒè‡“ç™ºä½œã®ãƒªã‚¹ã‚¯ãŒæ¸›å°‘ã—å§‹ã‚ã¾ã™', icon: 'ğŸ’“' },
            { minutes: 2880, text: 'å‘³è¦šã¨å—…è¦šãŒå›å¾©ã—å§‹ã‚ã¾ã™', icon: 'ğŸ‘ƒ' },
            { minutes: 10080, text: 'è‚ºæ©Ÿèƒ½ãŒæ”¹å–„ã—ã€å‘¼å¸ãŒæ¥½ã«ãªã‚Šã¾ã™', icon: 'ğŸŒ¬ï¸' },
            { minutes: 43200, text: 'å¾ªç’°å™¨ç³»ãŒå¤§å¹…ã«æ”¹å–„ã•ã‚Œã¾ã™', icon: 'ğŸ©¸' },
            { minutes: 129600, text: 'è‚ºãŒãã‚Œã„ã«ãªã‚Šã€æ„ŸæŸ“ç—‡ã®ãƒªã‚¹ã‚¯ãŒä½ä¸‹ã—ã¾ã™', icon: 'âœ¨' },
            { minutes: 525600, text: 'å¿ƒè‡“ç—…ã®ãƒªã‚¹ã‚¯ãŒåŠæ¸›ã—ã¾ã™', icon: 'ğŸ’ª' },
            { minutes: 2628000, text: 'è‚ºãŒã‚“ç­‰ã®ãƒªã‚¹ã‚¯ãŒå¤§å¹…ã«ä½ä¸‹ã—ã¾ã™', icon: 'ğŸ¯' },
            { minutes: 7884000, text: 'å¥åº·çŠ¶æ…‹ãŒã»ã¼éå–«ç…™è€…ãƒ¬ãƒ™ãƒ«ã«ï¼', icon: 'ğŸ†' }
        ];

        // é”æˆãƒãƒƒã‚¸
        const achievements = [
            { id: 'first-hour', minutes: 60, name: 'æœ€åˆã®1æ™‚é–“', icon: 'â­' },
            { id: 'first-day', minutes: 1440, name: '1æ—¥é”æˆ', icon: 'ğŸŒŸ' },
            { id: 'three-days', minutes: 4320, name: '3æ—¥é”æˆ', icon: 'âœ¨' },
            { id: 'one-week', minutes: 10080, name: '1é€±é–“é”æˆ', icon: 'ğŸ–ï¸' },
            { id: 'two-weeks', minutes: 20160, name: '2é€±é–“é”æˆ', icon: 'ğŸ…' },
            { id: 'one-month', minutes: 43200, name: '1ãƒ¶æœˆé”æˆ', icon: 'ğŸ¥‡' },
            { id: 'three-months', minutes: 129600, name: '3ãƒ¶æœˆé”æˆ', icon: 'ğŸ‘‘' },
            { id: 'six-months', minutes: 259200, name: '6ãƒ¶æœˆé”æˆ', icon: 'ğŸ’' },
            { id: 'one-year', minutes: 525600, name: '1å¹´é”æˆ', icon: 'ğŸ†' },
            { id: 'money-saver', condition: 'money', threshold: 10000, name: 'ç¯€ç´„1ä¸‡å††', icon: 'ğŸ’°' },
            { id: 'big-saver', condition: 'money', threshold: 50000, name: 'ç¯€ç´„5ä¸‡å††', icon: 'ğŸ’µ' },
            { id: 'mega-saver', condition: 'money', threshold: 100000, name: 'ç¯€ç´„10ä¸‡å††', icon: 'ğŸ’´' }
        ];

        // ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        const motivationMessages = [
            'ç´ æ™´ã‚‰ã—ã„ï¼ã‚ãªãŸã¯å¥åº·ã¸ã®ç¬¬ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ãŸã€‚',
            'ä¸€æœ¬å¸ã‚ãªã„åº¦ã«ã€ã‚ãªãŸã®ä½“ã¯å›å¾©ã—ã¦ã„ã¾ã™ã€‚',
            'ç¦ç…™ã¯æœ€é«˜ã®è‡ªå·±æŠ•è³‡ã§ã™ã€‚ç¶šã‘ã¾ã—ã‚‡ã†ï¼',
            'ã‚ãªãŸã®æ„å¿—ã®å¼·ã•ã¯ç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚',
            'æ¯æ—¥ãŒæ–°ã—ã„å‹åˆ©ã§ã™ã€‚èª‡ã‚Šã«æ€ã£ã¦ãã ã•ã„ï¼',
            'ã‚¿ãƒã‚³ãªã—ã®äººç”Ÿã¯ã€ã‚ˆã‚Šæ˜ã‚‹ãå¥åº·çš„ã§ã™ã€‚',
            'ã‚ãªãŸã¯è‡ªåˆ†ã®å¥åº·ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚',
            'ç¦ç…™ã®é“ã®ã‚Šã¯ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚ãªãŸãªã‚‰ã§ãã¾ã™ï¼',
            'ä»Šæ—¥ã‚‚ç¦ç…™ã‚’ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ç´ æ™´ã‚‰ã—ã„ï¼',
            'ã‚ãªãŸã®åŠªåŠ›ã¯ã€å¿…ãšå ±ã‚ã‚Œã¾ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼'
        ];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();

            // ç¾åœ¨æ™‚åˆ»ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦è¨­å®š
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('quitDate').value = now.toISOString().slice(0, 16);
        });

        // URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ç¦ç…™ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹
        function loadDataFromURL() {
            const params = new URLSearchParams(window.location.search);

            if (params.has('quitDate') && params.has('cigarettesPerDay') &&
                params.has('pricePerPack') && params.has('cigarettesPerPack')) {

                const cigarettesPerDay = parseInt(params.get('cigarettesPerDay'));
                const pricePerPack = parseInt(params.get('pricePerPack'));
                const cigarettesPerPack = parseInt(params.get('cigarettesPerPack'));

                return {
                    quitDate: params.get('quitDate'),
                    cigarettesPerDay,
                    pricePerPack,
                    cigarettesPerPack,
                    pricePerCigarette: pricePerPack / cigarettesPerPack
                };
            }

            return null;
        }

        // å…±æœ‰ç”¨URLã‚’ç”Ÿæˆ
        function generateShareURL() {
            if (!quitData) return null;

            const baseURL = window.location.origin + window.location.pathname;
            const params = new URLSearchParams({
                quitDate: quitData.quitDate,
                cigarettesPerDay: quitData.cigarettesPerDay,
                pricePerPack: quitData.pricePerPack,
                cigarettesPerPack: quitData.cigarettesPerPack
            });

            return `${baseURL}?${params.toString()}`;
        }

        // å…±æœ‰URLã‚’ã‚³ãƒ”ãƒ¼
        function copyShareURL() {
            const shareURL = generateShareURL();
            if (!shareURL) return;

            navigator.clipboard.writeText(shareURL).then(() => {
                const btn = document.getElementById('shareBtn');
                const originalText = btn.textContent;
                btn.textContent = 'âœ“ URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                btn.style.background = 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('URLã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            document.getElementById('setupForm').addEventListener('submit', handleSetup);
            document.getElementById('resetBtn').addEventListener('click', handleReset);
            document.getElementById('shareBtn').addEventListener('click', copyShareURL);

            // æ¸‡æœ›è¨˜éŒ²é–¢é€£
            document.getElementById('cravingFab').addEventListener('click', openCravingModal);
            document.getElementById('closeCravingModal').addEventListener('click', closeCravingModal);
            document.getElementById('cravingModal').addEventListener('click', function(e) {
                if (e.target.id === 'cravingModal') {
                    closeCravingModal();
                }
            });
            document.getElementById('cravingForm').addEventListener('submit', handleCravingSubmit);
            document.getElementById('intensitySlider').addEventListener('input', function(e) {
                document.getElementById('intensityValue').textContent = e.target.value;
            });
        }

        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ ã®å‡¦ç†
        function handleSetup(e) {
            e.preventDefault();

            const quitDate = new Date(document.getElementById('quitDate').value);
            const cigarettesPerDay = parseInt(document.getElementById('cigarettesPerDay').value);
            const pricePerPack = parseInt(document.getElementById('pricePerPack').value);
            const cigarettesPerPack = parseInt(document.getElementById('cigarettesPerPack').value);

            quitData = {
                quitDate: quitDate.toISOString(),
                cigarettesPerDay,
                pricePerPack,
                cigarettesPerPack,
                pricePerCigarette: pricePerPack / cigarettesPerPack
            };

            saveData();
            showDashboard();
            startUpdating();
        }

        // ãƒªã‚»ãƒƒãƒˆå‡¦ç†
        function handleReset() {
            if (confirm('æœ¬å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã‚Œã¾ã§ã®è¨˜éŒ²ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                localStorage.removeItem('quitData');
                quitData = null;
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
                showSetup();
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveData() {
            localStorage.setItem('quitData', JSON.stringify(quitData));
            localStorage.setItem('calendarData', JSON.stringify(calendarData));
            localStorage.setItem('cravings', JSON.stringify(cravings));
        }

        // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadData() {
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
            const savedCalendar = localStorage.getItem('calendarData');
            if (savedCalendar) {
                calendarData = JSON.parse(savedCalendar);
            }

            // æ¸‡æœ›è¨˜éŒ²ã®èª­ã¿è¾¼ã¿
            const savedCravings = localStorage.getItem('cravings');
            if (savedCravings) {
                cravings = JSON.parse(savedCravings);
            }

            // ã¾ãšURLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯
            const urlData = loadDataFromURL();
            if (urlData) {
                quitData = urlData;
                // URLã‹ã‚‰èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                saveData();
                showDashboard();
                startUpdating();
                return;
            }

            // URLã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
            const saved = localStorage.getItem('quitData');
            if (saved) {
                quitData = JSON.parse(saved);
                showDashboard();
                startUpdating();
            } else {
                showSetup();
            }
        }

        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ã‚’è¡¨ç¤º
        function showSetup() {
            document.getElementById('setup').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('dashboard').style.display = 'none';
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        function showDashboard() {
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('setup').style.display = 'none';
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('cravingFab').classList.remove('hidden');
        }

        // å®šæœŸæ›´æ–°ã®é–‹å§‹
        function startUpdating() {
            initTodayCalendarData();
            updateDashboard();
            updateInterval = setInterval(updateDashboard, 1000);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ›´æ–°
        function updateDashboard() {
            const now = new Date();
            const quitDate = new Date(quitData.quitDate);
            const diffMs = now - quitDate;

            if (diffMs < 0) {
                return; // æœªæ¥ã®æ—¥ä»˜ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
            }

            const diffMinutes = Math.floor(diffMs / 60000);
            const diffSeconds = Math.floor(diffMs / 1000);

            // æ™‚é–“ã®è¨ˆç®—
            const days = Math.floor(diffMinutes / 1440);
            const hours = Math.floor((diffMinutes % 1440) / 60);
            const minutes = diffMinutes % 60;
            const seconds = diffSeconds % 60;

            // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã®æ›´æ–°
            document.getElementById('days').textContent = days;
            document.getElementById('hours').textContent = hours;
            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds;

            // çµ±è¨ˆã®è¨ˆç®—
            const cigarettesAvoided = Math.floor((diffMinutes / 1440) * quitData.cigarettesPerDay);
            const moneySaved = Math.floor(cigarettesAvoided * quitData.pricePerCigarette);
            const lifeRegained = cigarettesAvoided * 11; // 1æœ¬ã‚ãŸã‚Š11åˆ†å¯¿å‘½ãŒç¸®ã‚€ã¨ã•ã‚Œã‚‹

            // å¥åº·ã‚¹ã‚³ã‚¢ã®è¨ˆç®—ï¼ˆ15å¹´ã§100%ï¼‰
            const healthScore = Math.min(100, Math.floor((diffMinutes / 7884000) * 100));

            // çµ±è¨ˆã®è¡¨ç¤º
            document.getElementById('moneySaved').textContent = `Â¥${moneySaved.toLocaleString()}`;
            document.getElementById('cigarettesAvoided').textContent = cigarettesAvoided.toLocaleString();
            document.getElementById('lifeRegained').textContent = lifeRegained.toLocaleString();
            document.getElementById('healthScore').textContent = `${healthScore}%`;

            // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã®æ›´æ–°
            updateMilestones(diffMinutes);

            // ãƒãƒƒã‚¸ã®æ›´æ–°
            updateBadges(diffMinutes, moneySaved);

            // é€²æ—ãƒãƒ¼ã®æ›´æ–°
            updateProgress(diffMinutes);

            // ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ›´æ–°ï¼ˆ1æ—¥ã”ã¨ã«å¤‰æ›´ï¼‰
            const messageIndex = days % motivationMessages.length;
            document.getElementById('motivationText').textContent = motivationMessages[messageIndex];

            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã®æ›´æ–°
            updateCalendarHeatmap();

            // æ¸‡æœ›è¨˜éŒ²ã®æ›´æ–°
            updateCravingsDisplay();
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã®ç”Ÿæˆã¨æ›´æ–°
        function updateCalendarHeatmap() {
            const container = document.getElementById('calendarHeatmap');
            container.innerHTML = '';

            const today = new Date();
            const quitDate = new Date(quitData.quitDate);

            // 52é€±é–“åˆ†ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
            const weeks = 52;
            const startDate = new Date(today);
            startDate.setDate(startDate.getDate() - (weeks * 7));

            for (let week = 0; week < weeks; week++) {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'calendar-week';

                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7) + day);

                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day';

                    const dateStr = formatDateStr(currentDate);
                    dayDiv.dataset.date = dateStr;

                    // æ—¥ä»˜ã®çŠ¶æ…‹ã‚’åˆ¤å®š
                    if (currentDate > today) {
                        // æœªæ¥ã®æ—¥ä»˜
                        dayDiv.classList.add('future');
                    } else if (currentDate < quitDate) {
                        // ç¦ç…™é–‹å§‹å‰ã®æ—¥ä»˜
                        dayDiv.classList.add('future');
                    } else {
                        // ç¦ç…™é–‹å§‹å¾Œã®æ—¥ä»˜
                        const dayData = calendarData[dateStr];
                        if (dayData) {
                            if (dayData.status === 'slip') {
                                dayDiv.classList.add('slip');
                            } else if (dayData.cravingCount > 0) {
                                dayDiv.classList.add('has-craving');
                            } else {
                                dayDiv.classList.add('success-perfect');
                            }
                        } else {
                            // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç¶™ç¶šä¸­ã¨ã—ã¦æ‰±ã†
                            dayDiv.classList.add('success-light');
                        }
                    }

                    // ãƒ›ãƒãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
                    dayDiv.addEventListener('mouseenter', function(e) {
                        showCalendarTooltip(e, currentDate, dateStr);
                    });

                    dayDiv.addEventListener('mouseleave', function() {
                        hideCalendarTooltip();
                    });

                    weekDiv.appendChild(dayDiv);
                }

                container.appendChild(weekDiv);
            }
        }

        // æ—¥ä»˜ã‚’æ–‡å­—åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆYYYY-MM-DDï¼‰
        function formatDateStr(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®è¡¨ç¤º
        function showCalendarTooltip(event, date, dateStr) {
            const tooltip = document.getElementById('calendarTooltip');
            const dayData = calendarData[dateStr];
            const today = new Date();
            const quitDate = new Date(quitData.quitDate);

            let content = '';

            if (date > today) {
                content = `${dateStr}<br>æœªåˆ°é”`;
            } else if (date < quitDate) {
                content = `${dateStr}<br>ç¦ç…™é–‹å§‹å‰`;
            } else {
                const daysDiff = Math.floor((date - quitDate) / (1000 * 60 * 60 * 24)) + 1;
                content = `${dateStr}<br>ç¦ç…™${daysDiff}æ—¥ç›®`;

                if (dayData) {
                    if (dayData.status === 'slip') {
                        content += '<br>âŒ ã‚¹ãƒªãƒƒãƒ—';
                    } else if (dayData.cravingCount > 0) {
                        content += `<br>âš ï¸ æ¸‡æœ›${dayData.cravingCount}å›`;
                    } else {
                        content += '<br>âœ“ å®Œç’§ãª1æ—¥';
                    }
                    if (dayData.notes) {
                        content += `<br>${dayData.notes}`;
                    }
                } else {
                    content += '<br>âœ“ ç¦ç…™ç¶™ç¶šä¸­';
                }
            }

            tooltip.innerHTML = content;
            tooltip.style.display = 'block';

            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = (rect.left + window.scrollX) + 'px';
            tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®éè¡¨ç¤º
        function hideCalendarTooltip() {
            const tooltip = document.getElementById('calendarTooltip');
            tooltip.style.display = 'none';
        }

        // ä»Šæ—¥ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ï¼ˆã¾ã å­˜åœ¨ã—ãªã„å ´åˆï¼‰
        function initTodayCalendarData() {
            const today = formatDateStr(new Date());
            if (!calendarData[today]) {
                calendarData[today] = {
                    status: 'success',
                    cravingCount: 0,
                    notes: ''
                };
                saveData();
            }
        }

        // æ¸‡æœ›è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openCravingModal() {
            document.getElementById('cravingModal').classList.add('active');
            document.getElementById('intensitySlider').value = 5;
            document.getElementById('intensityValue').textContent = 5;
        }

        // æ¸‡æœ›è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeCravingModal() {
            document.getElementById('cravingModal').classList.remove('active');
            document.getElementById('cravingForm').reset();
        }

        // æ¸‡æœ›è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
        function handleCravingSubmit(e) {
            e.preventDefault();

            const intensity = parseInt(document.getElementById('intensitySlider').value);
            const situation = document.querySelector('input[name="situation"]:checked').value;
            const trigger = document.getElementById('cravingTrigger').value;
            const notes = document.getElementById('cravingNotes').value;

            const craving = {
                id: new Date().getTime().toString(),
                timestamp: new Date().toISOString(),
                intensity: intensity,
                situation: situation,
                trigger: trigger,
                copingMethod: '',
                notes: notes,
                resolved: false
            };

            cravings.unshift(craving);

            // ä»Šæ—¥ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            const today = formatDateStr(new Date());
            if (calendarData[today]) {
                calendarData[today].cravingCount++;
            }

            saveData();
            closeCravingModal();
            updateCravingsDisplay();
            updateCalendarHeatmap();

            // æ¸‡æœ›è¨˜éŒ²å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            alert('æ¸‡æœ›ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚æ·±å‘¼å¸ã‚’ã—ã¦ã€æ°´ã‚’é£²ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã®æ„Ÿè¦šã¯å¿…ãšæ¶ˆãˆã¾ã™ã€‚');
        }

        // æ¸‡æœ›è¨˜éŒ²ã®è¡¨ç¤ºæ›´æ–°
        function updateCravingsDisplay() {
            // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
            const totalCravings = cravings.length;
            const avgIntensity = totalCravings > 0
                ? (cravings.reduce((sum, c) => sum + c.intensity, 0) / totalCravings).toFixed(1)
                : 0;

            const today = formatDateStr(new Date());
            const todayCravings = cravings.filter(c => {
                const cravingDate = formatDateStr(new Date(c.timestamp));
                return cravingDate === today;
            }).length;

            document.getElementById('totalCravings').textContent = totalCravings;
            document.getElementById('avgIntensity').textContent = avgIntensity;
            document.getElementById('todayCravings').textContent = todayCravings;

            // æ¸‡æœ›è¨˜éŒ²ä¸€è¦§ã®æ›´æ–°
            const listContainer = document.getElementById('cravingsList');
            listContainer.innerHTML = '';

            if (cravings.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">ã¾ã æ¸‡æœ›è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            // æœ€æ–°10ä»¶ã‚’è¡¨ç¤º
            const recentCravings = cravings.slice(0, 10);
            recentCravings.forEach(craving => {
                const div = document.createElement('div');
                div.className = 'craving-item';

                const date = new Date(craving.timestamp);
                const timeStr = date.toLocaleString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                div.innerHTML = `
                    <div class="craving-header">
                        <div class="craving-time">${timeStr}</div>
                        <div class="craving-intensity">å¼·åº¦: ${craving.intensity}/10</div>
                    </div>
                    <div class="craving-details">
                        <strong>çŠ¶æ³:</strong> ${craving.situation}<br>
                        ${craving.trigger ? `<strong>ãƒˆãƒªã‚¬ãƒ¼:</strong> ${craving.trigger}<br>` : ''}
                        ${craving.notes ? `<strong>ãƒ¡ãƒ¢:</strong> ${craving.notes}` : ''}
                    </div>
                `;

                listContainer.appendChild(div);
            });
        }

        // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã®æ›´æ–°
        function updateMilestones(currentMinutes) {
            const milestonesContainer = document.getElementById('milestones');
            milestonesContainer.innerHTML = '';

            let nextMilestoneFound = false;

            healthMilestones.forEach(milestone => {
                const div = document.createElement('div');
                div.className = 'milestone';

                let statusText = '';
                let statusClass = '';
                let remainingText = '';

                if (currentMinutes >= milestone.minutes) {
                    div.classList.add('achieved');
                    statusText = 'é”æˆæ¸ˆã¿ âœ“';
                    statusClass = 'milestone-status';
                } else if (!nextMilestoneFound) {
                    div.classList.add('next');
                    statusText = 'æ¬¡ã®ç›®æ¨™ â†’';
                    statusClass = 'milestone-status';
                    nextMilestoneFound = true;

                    // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—
                    const remainingMinutes = milestone.minutes - currentMinutes;
                    remainingText = `<div class="milestone-remaining">ã‚ã¨ ${formatRemainingTime(remainingMinutes)}</div>`;
                } else {
                    div.classList.add('upcoming');
                    statusText = 'æœªé”æˆ';
                    statusClass = 'milestone-status';

                    // æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—
                    const remainingMinutes = milestone.minutes - currentMinutes;
                    remainingText = `<div class="milestone-remaining">ã‚ã¨ ${formatRemainingTime(remainingMinutes)}</div>`;
                }

                const timeText = formatMilestoneTime(milestone.minutes);

                div.innerHTML = `
                    <span class="milestone-icon">${milestone.icon}</span>
                    <div class="${statusClass}">${statusText}</div>
                    <div class="milestone-time">${timeText}</div>
                    <div class="milestone-benefit">${milestone.text}</div>
                    ${remainingText}
                `;

                milestonesContainer.appendChild(div);
            });
        }

        // æ®‹ã‚Šæ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatRemainingTime(minutes) {
            if (minutes < 60) {
                return `${minutes}åˆ†`;
            } else if (minutes < 1440) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return mins > 0 ? `${hours}æ™‚é–“${mins}åˆ†` : `${hours}æ™‚é–“`;
            } else if (minutes < 43200) {
                const days = Math.floor(minutes / 1440);
                const hours = Math.floor((minutes % 1440) / 60);
                return hours > 0 ? `${days}æ—¥${hours}æ™‚é–“` : `${days}æ—¥`;
            } else if (minutes < 525600) {
                const months = Math.floor(minutes / 43200);
                const days = Math.floor((minutes % 43200) / 1440);
                return days > 0 ? `${months}ãƒ¶æœˆ${days}æ—¥` : `${months}ãƒ¶æœˆ`;
            } else {
                const years = Math.floor(minutes / 525600);
                const months = Math.floor((minutes % 525600) / 43200);
                return months > 0 ? `${years}å¹´${months}ãƒ¶æœˆ` : `${years}å¹´`;
            }
        }

        // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³æ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatMilestoneTime(minutes) {
            if (minutes < 60) {
                return `${minutes}åˆ†`;
            } else if (minutes < 1440) {
                return `${Math.floor(minutes / 60)}æ™‚é–“`;
            } else if (minutes < 43200) {
                return `${Math.floor(minutes / 1440)}æ—¥`;
            } else if (minutes < 525600) {
                return `${Math.floor(minutes / 43200)}ãƒ¶æœˆ`;
            } else {
                return `${Math.floor(minutes / 525600)}å¹´`;
            }
        }

        // ãƒãƒƒã‚¸ã®æ›´æ–°
        function updateBadges(currentMinutes, moneySaved) {
            const badgesContainer = document.getElementById('badges');
            badgesContainer.innerHTML = '';

            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = 'badge';

                let earned = false;
                if (achievement.condition === 'money') {
                    earned = moneySaved >= achievement.threshold;
                } else {
                    earned = currentMinutes >= achievement.minutes;
                }

                if (earned) {
                    div.classList.add('earned');
                }

                div.innerHTML = `
                    <div class="badge-icon">${achievement.icon}</div>
                    <div class="badge-name">${achievement.name}</div>
                `;

                badgesContainer.appendChild(div);
            });
        }

        // é€²æ—ãƒãƒ¼ã®æ›´æ–°
        function updateProgress(currentMinutes) {
            // 1é€±é–“ï¼ˆ10080åˆ†ï¼‰
            const week1Percent = Math.min(100, Math.floor((currentMinutes / 10080) * 100));
            document.getElementById('week1Progress').textContent = `${week1Percent}%`;
            document.getElementById('week1Bar').style.width = `${week1Percent}%`;
            document.getElementById('week1Bar').textContent = week1Percent > 0 ? `${week1Percent}%` : '';

            // 1ãƒ¶æœˆï¼ˆ43200åˆ†ï¼‰
            const month1Percent = Math.min(100, Math.floor((currentMinutes / 43200) * 100));
            document.getElementById('month1Progress').textContent = `${month1Percent}%`;
            document.getElementById('month1Bar').style.width = `${month1Percent}%`;
            document.getElementById('month1Bar').textContent = month1Percent > 0 ? `${month1Percent}%` : '';

            // 1å¹´ï¼ˆ525600åˆ†ï¼‰
            const year1Percent = Math.min(100, Math.floor((currentMinutes / 525600) * 100));
            document.getElementById('year1Progress').textContent = `${year1Percent}%`;
            document.getElementById('year1Bar').style.width = `${year1Percent}%`;
            document.getElementById('year1Bar').textContent = year1Percent > 0 ? `${year1Percent}%` : '';
        }
    </script>
</body>
</html>
