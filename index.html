<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¶ÅÁÖô„Çµ„Éù„Éº„Éà - „ÅÇ„Å™„Åü„ÅÆÂÅ•Â∫∑„Å®Êú™Êù•„ÅÆ„Åü„ÇÅ„Å´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .setup-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .setup-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-top: 10px;
        }

        #shareBtn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            margin-bottom: 10px;
        }

        #shareBtn:hover {
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .dashboard {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stat-label {
            color: #888;
            font-size: 0.9em;
        }

        .milestones-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .milestones-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .milestone {
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            border-left: 5px solid #e0e0e0;
            background: #f8f9fa;
            transition: all 0.3s;
            position: relative;
        }

        .milestone.achieved {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-left-color: #28a745;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }

        .milestone.next {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffe8a1 100%);
        }

        .milestone.upcoming {
            border-left-color: #ccc;
            background: #ffffff;
            opacity: 0.9;
        }

        .milestone-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .milestone.achieved .milestone-status {
            background: #28a745;
            color: white;
        }

        .milestone.next .milestone-status {
            background: #ffc107;
            color: #333;
        }

        .milestone.upcoming .milestone-status {
            background: #e0e0e0;
            color: #666;
        }

        .milestone-time {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .milestone-benefit {
            color: #555;
            line-height: 1.6;
        }

        .milestone-remaining {
            margin-top: 8px;
            color: #888;
            font-size: 0.9em;
            font-style: italic;
        }

        .milestone-icon {
            float: right;
            font-size: 1.5em;
        }

        .achievements-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .achievements-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .badge {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: #f8f9fa;
            opacity: 0.4;
            transition: all 0.3s;
        }

        .badge.earned {
            opacity: 1;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            transform: scale(1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .badge-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .badge-name {
            font-weight: 600;
            font-size: 0.9em;
        }

        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .progress-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .progress-item {
            margin-bottom: 25px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }

        .motivation-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .motivation-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .motivation-card p {
            font-size: 1.1em;
            line-height: 1.6;
            opacity: 0.95;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .badges-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        .timer-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .timer-display h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .timer-value {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .timer-segments {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .timer-segment {
            text-align: center;
        }

        .timer-segment-value {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }

        .timer-segment-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Á¶ÅÁÖôÁ∂ôÁ∂ö„Ç´„É¨„É≥„ÉÄ„ÉºÔºàGitHubÈ¢®„Éí„Éº„Éà„Éû„ÉÉ„ÉóÔºâ */
        .calendar-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .calendar-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .calendar-heatmap {
            display: flex;
            gap: 3px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .calendar-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .calendar-day {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            background: #ebedf0;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .calendar-day.future {
            background: #f8f9fa;
            border: 1px dashed #e0e0e0;
        }

        .calendar-day.success-light {
            background: #84fab0;
        }

        .calendar-day.success-perfect {
            background: #28a745;
        }

        .calendar-day.has-craving {
            background: #ffc107;
        }

        .calendar-day.slip {
            background: #dc3545;
        }

        .calendar-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.85em;
            color: #666;
        }

        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .calendar-legend-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .calendar-day {
                width: 12px;
                height: 12px;
            }

            .calendar-heatmap {
                gap: 2px;
            }

            .calendar-week {
                gap: 2px;
            }
        }

        /* Ê∏áÊúõË®òÈå≤„Ç∑„Çπ„ÉÜ„É† */
        .fab-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(245, 87, 108, 0.5);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(245, 87, 108, 0.7);
        }

        .fab-button:active {
            transform: scale(0.95);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 1.5em;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: #333;
        }

        .intensity-slider-container {
            margin: 20px 0;
        }

        .intensity-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #84fab0 0%, #ffc107 50%, #dc3545 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .intensity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .intensity-value {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .radio-option {
            flex: 1;
            min-width: 100px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .radio-option label:hover {
            border-color: #667eea;
        }

        .cravings-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .cravings-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .craving-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #f5576c;
        }

        .craving-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .craving-time {
            font-weight: bold;
            color: #667eea;
        }

        .craving-intensity {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .craving-details {
            color: #555;
            line-height: 1.6;
        }

        .craving-details strong {
            color: #333;
        }

        .craving-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .craving-stat-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .craving-stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .craving-stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .fab-button {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }

            .modal-content {
                padding: 20px;
            }

            .radio-option {
                min-width: 80px;
            }
        }

        /* ÂØæÂá¶Ê≥ï„Éá„Éº„Çø„Éô„Éº„Çπ */
        .coping-strategies-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .coping-strategies-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .strategy-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-filter {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .category-filter.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .category-filter:hover {
            border-color: #667eea;
        }

        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .strategy-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .strategy-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .strategy-emoji {
            font-size: 2em;
        }

        .strategy-favorite {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .strategy-favorite:hover {
            transform: scale(1.2);
        }

        .strategy-favorite.active {
            color: #ffc107;
        }

        .strategy-name {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .strategy-duration {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .strategy-description {
            color: #666;
            line-height: 1.5;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .strategy-stats {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #999;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .strategy-use-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
            transition: all 0.3s;
        }

        .strategy-use-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        /* Á∑äÊÄ•SOS„Éú„Çø„É≥ */
        .sos-button {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            font-size: 2.5em;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(220, 53, 69, 0.6);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-sos 2s infinite;
        }

        @keyframes pulse-sos {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .sos-button:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 30px rgba(220, 53, 69, 0.8);
        }

        .sos-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 53, 69, 0.95);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .sos-overlay.active {
            display: flex;
        }

        .sos-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
        }

        .sos-title {
            font-size: 2.5em;
            color: #dc3545;
            margin-bottom: 20px;
        }

        .sos-message {
            font-size: 1.3em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 30px;
        }

        .sos-stats {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .sos-stats-item {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin: 10px 0;
        }

        .sos-countdown {
            font-size: 4em;
            color: #667eea;
            font-weight: bold;
            margin: 30px 0;
        }

        .sos-actions {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .sos-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sos-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .sos-overcome-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            font-size: 1.2em;
            padding: 18px 40px;
        }

        @media (max-width: 768px) {
            .sos-button {
                bottom: 80px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 2em;
            }

            .sos-content {
                padding: 25px;
            }

            .sos-title {
                font-size: 2em;
            }

            .sos-message {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üö≠ Á¶ÅÁÖô„Çµ„Éù„Éº„Éà</h1>
            <p>„ÅÇ„Å™„Åü„ÅÆÂÅ•Â∫∑„Å®Êú™Êù•„ÅÆ„Åü„ÇÅ„Å´</p>
        </header>

        <!-- „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢ -->
        <div id="setup" class="setup-card">
            <h2>Á¶ÅÁÖô„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ</h2>
            <form id="setupForm">
                <div class="form-group">
                    <label for="quitDate">Á¶ÅÁÖôÈñãÂßãÊó•ÊôÇ</label>
                    <input type="datetime-local" id="quitDate" required>
                </div>
                <div class="form-group">
                    <label for="cigarettesPerDay">1Êó•„ÅÇ„Åü„Çä„ÅÆÂñ´ÁÖôÊú¨Êï∞</label>
                    <input type="number" id="cigarettesPerDay" min="1" value="20" required>
                </div>
                <div class="form-group">
                    <label for="pricePerPack">1ÁÆ±„ÅÆ‰æ°Ê†ºÔºàÂÜÜÔºâ</label>
                    <input type="number" id="pricePerPack" min="1" value="600" required>
                </div>
                <div class="form-group">
                    <label for="cigarettesPerPack">1ÁÆ±„ÅÇ„Åü„Çä„ÅÆÊú¨Êï∞</label>
                    <input type="number" id="cigarettesPerPack" min="1" value="20" required>
                </div>
                <button type="submit" class="btn">Á¶ÅÁÖô„ÇíÈñãÂßã„Åô„Çã</button>
            </form>
        </div>

        <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
        <div id="dashboard" class="dashboard">
            <!-- „Çø„Ç§„Éû„ÉºË°®Á§∫ -->
            <div class="timer-display">
                <h2>Á¶ÅÁÖôÁ∂ôÁ∂öÊôÇÈñì</h2>
                <div class="timer-segments">
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="days">0</span>
                        <span class="timer-segment-label">Êó•</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="hours">0</span>
                        <span class="timer-segment-label">ÊôÇÈñì</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="minutes">0</span>
                        <span class="timer-segment-label">ÂàÜ</span>
                    </div>
                    <div class="timer-segment">
                        <span class="timer-segment-value" id="seconds">0</span>
                        <span class="timer-segment-label">Áßí</span>
                    </div>
                </div>
            </div>

            <!-- Á¶ÅÁÖôÁ∂ôÁ∂ö„Ç´„É¨„É≥„ÉÄ„Éº -->
            <div class="calendar-card">
                <h2>Á¶ÅÁÖôÁ∂ôÁ∂ö„Ç´„É¨„É≥„ÉÄ„Éº</h2>
                <div id="calendarHeatmap" class="calendar-heatmap"></div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #f8f9fa; border: 1px dashed #e0e0e0;"></div>
                        <span>Êú™Âà∞ÈÅî</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #84fab0;"></div>
                        <span>Á∂ôÁ∂ö‰∏≠</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #28a745;"></div>
                        <span>ÂÆåÁíß„Å™1Êó•</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #ffc107;"></div>
                        <span>Ê∏áÊúõ„ÅÇ„Çä</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-box" style="background: #dc3545;"></div>
                        <span>„Çπ„É™„ÉÉ„Éó</span>
                    </div>
                </div>
            </div>
            <div class="calendar-tooltip" id="calendarTooltip"></div>

            <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" id="moneySaved">¬•0</div>
                    <div class="stat-label">ÁØÄÁ¥Ñ„Åó„ÅüÈáëÈ°ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üö¨</div>
                    <div class="stat-value" id="cigarettesAvoided">0</div>
                    <div class="stat-label">Âê∏„Çè„Å™„Åã„Å£„Åü„Çø„Éê„Ç≥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-value" id="lifeRegained">0</div>
                    <div class="stat-label">Âèñ„ÇäÊàª„Åó„ÅüÊôÇÈñìÔºàÂàÜÔºâ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ù§Ô∏è</div>
                    <div class="stat-value" id="healthScore">0%</div>
                    <div class="stat-label">ÂÅ•Â∫∑ÂõûÂæ©Â∫¶</div>
                </div>
            </div>

            <!-- „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="motivation-card">
                <h3>‰ªäÊó•„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏</h3>
                <p id="motivationText">Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÁ¶ÅÁÖô„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÊó•‰∏ÄÊó•„Åå„ÅÇ„Å™„Åü„ÅÆÂãùÂà©„Åß„ÅôÔºÅ</p>
            </div>

            <!-- ÂÅ•Â∫∑„Éû„Ç§„É´„Çπ„Éà„Éº„É≥ -->
            <div class="milestones-card">
                <h2>ÂÅ•Â∫∑„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</h2>
                <div id="milestones"></div>
            </div>

            <!-- ÈÄ≤ÊçóÁä∂Ê≥Å -->
            <div class="progress-card">
                <h2>ÁõÆÊ®ô„Åæ„Åß„ÅÆÈÄ≤Êçó</h2>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1ÈÄ±ÈñìÈÅîÊàê</span>
                        <span id="week1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="week1Bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1„É∂ÊúàÈÅîÊàê</span>
                        <span id="month1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="month1Bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>1Âπ¥ÈÅîÊàê</span>
                        <span id="year1Progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="year1Bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- ÈÅîÊàê„Éê„ÉÉ„Ç∏ -->
            <div class="achievements-card">
                <h2>ÈÅîÊàê„Éê„ÉÉ„Ç∏</h2>
                <div class="badges-grid" id="badges"></div>
            </div>

            <!-- ÂØæÂá¶Ê≥ï„Éá„Éº„Çø„Éô„Éº„Çπ -->
            <div class="coping-strategies-card">
                <h2>ÂØæÂá¶Ê≥ï„Éá„Éº„Çø„Éô„Éº„Çπ</h2>
                <div class="strategy-categories">
                    <button class="category-filter active" data-category="all">„Åô„Åπ„Å¶</button>
                    <button class="category-filter" data-category="Âç≥ÂäπÊÄß">Âç≥ÂäπÊÄßÔºà1-5ÂàÜÔºâ</button>
                    <button class="category-filter" data-category="‰∏≠ÊúüÂØæÁ≠ñ">‰∏≠ÊúüÂØæÁ≠ñÔºà10-30ÂàÜÔºâ</button>
                    <button class="category-filter" data-category="Èï∑ÊúüÊà¶Áï•">Èï∑ÊúüÊà¶Áï•</button>
                    <button class="category-filter" data-category="favorite">„ÅäÊ∞ó„Å´ÂÖ•„Çä</button>
                </div>
                <div class="strategy-grid" id="strategyGrid"></div>
            </div>

            <!-- Ê∏áÊúõË®òÈå≤‰∏ÄË¶ß -->
            <div class="cravings-card">
                <h2>Ê∏áÊúõË®òÈå≤</h2>
                <div class="craving-stats" id="cravingStats">
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="totalCravings">0</div>
                        <div class="craving-stat-label">Á∑èÊ∏áÊúõÂõûÊï∞</div>
                    </div>
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="avgIntensity">0</div>
                        <div class="craving-stat-label">Âπ≥ÂùáÂº∑Â∫¶</div>
                    </div>
                    <div class="craving-stat-box">
                        <div class="craving-stat-value" id="todayCravings">0</div>
                        <div class="craving-stat-label">‰ªäÊó•„ÅÆÊ∏áÊúõ</div>
                    </div>
                </div>
                <div id="cravingsList"></div>
            </div>

            <button class="btn" id="shareBtn">üîó ÈÄ≤Êçó„ÇíÂÖ±Êúâ„Åô„ÇãURL„Çí„Ç≥„Éî„Éº</button>
            <button class="btn btn-secondary" id="resetBtn">„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà</button>
        </div>
    </div>

    <!-- Ê∏áÊúõË®òÈå≤FAB„Éú„Çø„É≥ -->
    <button class="fab-button hidden" id="cravingFab" title="Âê∏„ÅÑ„Åü„Åè„Å™„Å£„Åü">üö¨</button>

    <!-- Á∑äÊÄ•SOS„Éú„Çø„É≥ -->
    <button class="sos-button hidden" id="sosButton" title="Á∑äÊÄ•SOS">üÜò</button>

    <!-- Á∑äÊÄ•SOS„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="sos-overlay" id="sosOverlay">
        <div class="sos-content">
            <div class="sos-title">üö® „Å°„Çá„Å£„Å®ÂæÖ„Å£„Å¶ÔºÅ</div>
            <div class="sos-message" id="sosMessage"></div>
            <div class="sos-stats" id="sosStats"></div>
            <div class="sos-countdown" id="sosCountdown">5:00</div>
            <div class="sos-actions">
                <button class="sos-action-btn" onclick="alert('Ê∑±ÂëºÂê∏Ôºö4ÁßíÂê∏„Å£„Å¶„ÄÅ7ÁßíÊ≠¢„ÇÅ„Å¶„ÄÅ8ÁßíÂêê„Åè')">ü´Å Ê∑±ÂëºÂê∏„Åô„Çã</button>
                <button class="sos-action-btn" onclick="alert('Ê∞¥„ÇíÈ£≤„Åø„Åæ„Åó„Çá„ÅÜÔºÅ')">üíß Ê∞¥„ÇíÈ£≤„ÇÄ</button>
                <button class="sos-action-btn" onclick="alert('Áü≠„ÅÑÊï£Ê≠©„Å´Ë°å„Åç„Åæ„Åó„Çá„ÅÜ')">üö∂ Êï£Ê≠©„Åô„Çã</button>
            </div>
            <button class="sos-action-btn sos-overcome-btn" id="sosOvercomeBtn">‚úì ‰πó„ÇäË∂ä„Åà„ÅüÔºÅ</button>
        </div>
    </div>

    <!-- Ê∏áÊúõË®òÈå≤„É¢„Éº„ÉÄ„É´ -->
    <div class="modal-overlay" id="cravingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ê∏áÊúõ„ÇíË®òÈå≤</h2>
                <button class="modal-close" id="closeCravingModal">√ó</button>
            </div>
            <form id="cravingForm">
                <div class="form-group">
                    <label>Ê∏áÊúõ„ÅÆÂº∑„ÅïÔºà1-10Ôºâ</label>
                    <div class="intensity-slider-container">
                        <input type="range" class="intensity-slider" id="intensitySlider" min="1" max="10" value="5">
                        <div class="intensity-value" id="intensityValue">5</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Áä∂Ê≥Å</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="sit1" name="situation" value="‰ªï‰∫ã‰∏≠" checked>
                            <label for="sit1">‰ªï‰∫ã‰∏≠</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit2" name="situation" value="È£üÂæå">
                            <label for="sit2">È£üÂæå</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit3" name="situation" value="È£≤ÈÖíÊôÇ">
                            <label for="sit3">È£≤ÈÖíÊôÇ</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit4" name="situation" value="„Çπ„Éà„É¨„Çπ">
                            <label for="sit4">„Çπ„Éà„É¨„Çπ</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sit5" name="situation" value="„Åù„ÅÆ‰ªñ">
                            <label for="sit5">„Åù„ÅÆ‰ªñ</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cravingTrigger">„Éà„É™„Ç¨„Éº</label>
                    <input type="text" id="cravingTrigger" placeholder="‰Ωï„Åå„Åç„Å£„Åã„Åë„Åß„Åô„ÅãÔºü">
                </div>

                <div class="form-group">
                    <label for="cravingNotes">„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                    <input type="text" id="cravingNotes" placeholder="Ê∞óÊåÅ„Å°„ÇÑÁä∂Ê≥Å„ÇíË®òÈå≤...">
                </div>

                <button type="submit" class="btn">Ë®òÈå≤„Åô„Çã</button>
            </form>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let quitData = null;
        let updateInterval = null;
        let calendarData = {};
        let cravings = [];
        let copingStrategies = [];
        let currentStrategyFilter = 'all';
        let sosHistory = [];
        let sosCountdownInterval = null;

        // ÂÅ•Â∫∑„Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÔºàÂåªÂ≠¶ÁöÑÊ†πÊã†„Å´Âü∫„Å•„ÅèÔºâ
        const healthMilestones = [
            { minutes: 20, text: 'Ë°ÄÂúß„Å®ËÑàÊãç„ÅåÊ≠£Â∏∏ÂÄ§„Å´Êàª„ÇäÂßã„ÇÅ„Åæ„Åô', icon: '‚ù§Ô∏è' },
            { minutes: 480, text: 'Ë°Ä‰∏≠„ÅÆ‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†ÊøÉÂ∫¶„ÅåÊ≠£Â∏∏ÂÄ§„Å´Êàª„Çä„Åæ„Åô', icon: 'ü´Å' },
            { minutes: 1440, text: 'ÂøÉËáìÁô∫‰Ωú„ÅÆ„É™„Çπ„ÇØ„ÅåÊ∏õÂ∞ë„ÅóÂßã„ÇÅ„Åæ„Åô', icon: 'üíì' },
            { minutes: 2880, text: 'Âë≥Ë¶ö„Å®ÂóÖË¶ö„ÅåÂõûÂæ©„ÅóÂßã„ÇÅ„Åæ„Åô', icon: 'üëÉ' },
            { minutes: 10080, text: 'ËÇ∫Ê©üËÉΩ„ÅåÊîπÂñÑ„Åó„ÄÅÂëºÂê∏„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô', icon: 'üå¨Ô∏è' },
            { minutes: 43200, text: 'Âæ™Áí∞Âô®Á≥ª„ÅåÂ§ßÂπÖ„Å´ÊîπÂñÑ„Åï„Çå„Åæ„Åô', icon: 'ü©∏' },
            { minutes: 129600, text: 'ËÇ∫„Åå„Åç„Çå„ÅÑ„Å´„Å™„Çä„ÄÅÊÑüÊüìÁóá„ÅÆ„É™„Çπ„ÇØ„Åå‰Ωé‰∏ã„Åó„Åæ„Åô', icon: '‚ú®' },
            { minutes: 525600, text: 'ÂøÉËáìÁóÖ„ÅÆ„É™„Çπ„ÇØ„ÅåÂçäÊ∏õ„Åó„Åæ„Åô', icon: 'üí™' },
            { minutes: 2628000, text: 'ËÇ∫„Åå„ÇìÁ≠â„ÅÆ„É™„Çπ„ÇØ„ÅåÂ§ßÂπÖ„Å´‰Ωé‰∏ã„Åó„Åæ„Åô', icon: 'üéØ' },
            { minutes: 7884000, text: 'ÂÅ•Â∫∑Áä∂ÊÖã„Åå„Åª„ÅºÈùûÂñ´ÁÖôËÄÖ„É¨„Éô„É´„Å´ÔºÅ', icon: 'üèÜ' }
        ];

        // ÈÅîÊàê„Éê„ÉÉ„Ç∏
        const achievements = [
            { id: 'first-hour', minutes: 60, name: 'ÊúÄÂàù„ÅÆ1ÊôÇÈñì', icon: '‚≠ê' },
            { id: 'first-day', minutes: 1440, name: '1Êó•ÈÅîÊàê', icon: 'üåü' },
            { id: 'three-days', minutes: 4320, name: '3Êó•ÈÅîÊàê', icon: '‚ú®' },
            { id: 'one-week', minutes: 10080, name: '1ÈÄ±ÈñìÈÅîÊàê', icon: 'üéñÔ∏è' },
            { id: 'two-weeks', minutes: 20160, name: '2ÈÄ±ÈñìÈÅîÊàê', icon: 'üèÖ' },
            { id: 'one-month', minutes: 43200, name: '1„É∂ÊúàÈÅîÊàê', icon: 'ü•á' },
            { id: 'three-months', minutes: 129600, name: '3„É∂ÊúàÈÅîÊàê', icon: 'üëë' },
            { id: 'six-months', minutes: 259200, name: '6„É∂ÊúàÈÅîÊàê', icon: 'üíé' },
            { id: 'one-year', minutes: 525600, name: '1Âπ¥ÈÅîÊàê', icon: 'üèÜ' },
            { id: 'money-saver', condition: 'money', threshold: 10000, name: 'ÁØÄÁ¥Ñ1‰∏áÂÜÜ', icon: 'üí∞' },
            { id: 'big-saver', condition: 'money', threshold: 50000, name: 'ÁØÄÁ¥Ñ5‰∏áÂÜÜ', icon: 'üíµ' },
            { id: 'mega-saver', condition: 'money', threshold: 100000, name: 'ÁØÄÁ¥Ñ10‰∏áÂÜÜ', icon: 'üí¥' }
        ];

        // ÂØæÂá¶Ê≥ï„ÅÆÂàùÊúü„Éá„Éº„Çø
        const defaultCopingStrategies = [
            {
                id: "deep-breathing",
                name: "Ê∑±ÂëºÂê∏„Ç®„ÇØ„Çµ„Çµ„Ç§„Ç∫",
                category: "Âç≥ÂäπÊÄß",
                duration: "2-3ÂàÜ",
                emoji: "ü´Å",
                description: "4ÁßíÂê∏„Å£„Å¶„ÄÅ7ÁßíÊ≠¢„ÇÅ„Å¶„ÄÅ8ÁßíÂêê„Åè„ÄÇ„Åì„Çå„Çí3-5ÂõûÁπ∞„ÇäËøî„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "water-drink",
                name: "Ê∞¥„ÇíÈ£≤„ÇÄ",
                category: "Âç≥ÂäπÊÄß",
                duration: "1ÂàÜ",
                emoji: "üíß",
                description: "„Ç≥„ÉÉ„Éó1ÊùØ„ÅÆÊ∞¥„Çí„ÇÜ„Å£„Åè„ÇäÈ£≤„Åø„Åæ„Åô„ÄÇÂè£„ÅÆ‰∏≠„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "hand-massage",
                name: "Êâã„ÅÆ„Éû„ÉÉ„Çµ„Éº„Ç∏",
                category: "Âç≥ÂäπÊÄß",
                duration: "2-3ÂàÜ",
                emoji: "ü§≤",
                description: "Êâã„ÅÆ„ÉÑ„Éú„ÇíÊäº„Åó„Åü„Çä„ÄÅÊåá„ÇíÊèâ„Çì„Å†„Çä„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "walk",
                name: "Áü≠„ÅÑÊï£Ê≠©",
                category: "‰∏≠ÊúüÂØæÁ≠ñ",
                duration: "10-15ÂàÜ",
                emoji: "üö∂",
                description: "Â§ñ„ÅÆÁ©∫Ê∞ó„ÇíÂê∏„ÅÑ„Å™„Åå„ÇâÊ≠©„Åç„Åæ„Åô„ÄÇÁí∞Â¢É„ÇíÂ§â„Åà„Çã„Åì„Å®„ÅåÂäπÊûúÁöÑ„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "call-friend",
                name: "Âèã‰∫∫„Å´ÈõªË©±",
                category: "‰∏≠ÊúüÂØæÁ≠ñ",
                duration: "5-10ÂàÜ",
                emoji: "üìû",
                description: "„Çµ„Éù„Éº„Éà„Åó„Å¶„Åè„Çå„Çã‰∫∫„Å®Ë©±„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "snack",
                name: "ÂÅ•Â∫∑ÁöÑ„Å™„Çπ„Éä„ÉÉ„ÇØ",
                category: "Âç≥ÂäπÊÄß",
                duration: "3-5ÂàÜ",
                emoji: "ü•ï",
                description: "„Éã„É≥„Ç∏„É≥„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ„ÄÅ„Ç¨„É†„ÄÅ„Éä„ÉÉ„ÉÑ„Å™„Å©„ÇíÈ£ü„Åπ„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "exercise",
                name: "ËªΩ„ÅÑÈÅãÂãï",
                category: "‰∏≠ÊúüÂØæÁ≠ñ",
                duration: "15-30ÂàÜ",
                emoji: "üèÉ",
                description: "„Ç∏„Éß„ÇÆ„É≥„Ç∞„ÄÅ„Çπ„Éà„É¨„ÉÉ„ÉÅ„ÄÅ„É®„Ç¨„Å™„Å©‰Ωì„ÇíÂãï„Åã„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "hobby",
                name: "Ë∂£Âë≥„Å´Ê≤°È†≠",
                category: "Èï∑ÊúüÊà¶Áï•",
                duration: "30ÂàÜ‰ª•‰∏ä",
                emoji: "üé®",
                description: "Ë™≠Êõ∏„ÄÅÈü≥Ê•Ω„ÄÅ„Ç≤„Éº„É†„ÄÅ„ÇØ„É©„Éï„Éà„Å™„Å©Â•Ω„Åç„Å™„Åì„Å®„Çí„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "meditation",
                name: "ÁûëÊÉ≥„Éª„Éû„Ç§„É≥„Éâ„Éï„É´„Éç„Çπ",
                category: "‰∏≠ÊúüÂØæÁ≠ñ",
                duration: "10-20ÂàÜ",
                emoji: "üßò",
                description: "Èùô„Åã„Å´Â∫ß„Å£„Å¶„ÄÅÂëºÂê∏„Å´ÊÑèË≠ò„ÇíÂêë„Åë„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            },
            {
                id: "support-group",
                name: "„Çµ„Éù„Éº„Éà„Ç∞„É´„Éº„ÉóÂèÇÂä†",
                category: "Èï∑ÊúüÊà¶Áï•",
                duration: "Á∂ôÁ∂öÁöÑ",
                emoji: "üë•",
                description: "Á¶ÅÁÖô‰ª≤Èñì„Å®„ÅÆ„Ç≥„Éü„É•„Éã„ÉÜ„Ç£„Å´ÂèÇÂä†„Åó„Åæ„Åô„ÄÇ",
                effectiveness: 0,
                timesUsed: 0,
                favorite: false
            }
        ];

        // „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„É°„ÉÉ„Çª„Éº„Ç∏
        const motivationMessages = [
            'Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ„ÅÇ„Å™„Åü„ÅØÂÅ•Â∫∑„Å∏„ÅÆÁ¨¨‰∏ÄÊ≠©„ÇíË∏è„ÅøÂá∫„Åó„Åæ„Åó„Åü„ÄÇ',
            '‰∏ÄÊú¨Âê∏„Çè„Å™„ÅÑÂ∫¶„Å´„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰Ωì„ÅØÂõûÂæ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
            'Á¶ÅÁÖô„ÅØÊúÄÈ´ò„ÅÆËá™Â∑±ÊäïË≥á„Åß„Åô„ÄÇÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ',
            '„ÅÇ„Å™„Åü„ÅÆÊÑèÂøó„ÅÆÂº∑„Åï„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„ÄÇ',
            'ÊØéÊó•„ÅåÊñ∞„Åó„ÅÑÂãùÂà©„Åß„Åô„ÄÇË™á„Çä„Å´ÊÄù„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ',
            '„Çø„Éê„Ç≥„Å™„Åó„ÅÆ‰∫∫Áîü„ÅØ„ÄÅ„Çà„ÇäÊòé„Çã„ÅèÂÅ•Â∫∑ÁöÑ„Åß„Åô„ÄÇ',
            '„ÅÇ„Å™„Åü„ÅØËá™ÂàÜ„ÅÆÂÅ•Â∫∑„Çí„Ç≥„É≥„Éà„É≠„Éº„É´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
            'Á¶ÅÁÖô„ÅÆÈÅì„ÅÆ„Çä„ÅØÁ∞°Âçò„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„ÅÇ„Å™„Åü„Å™„Çâ„Åß„Åç„Åæ„ÅôÔºÅ',
            '‰ªäÊó•„ÇÇÁ¶ÅÁÖô„ÇíÁ∂ö„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅ',
            '„ÅÇ„Å™„Åü„ÅÆÂä™Âäõ„ÅØ„ÄÅÂøÖ„ÅöÂ†±„Çè„Çå„Åæ„Åô„ÄÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ'
        ];

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();

            // ÁèæÂú®ÊôÇÂàª„Çí„Éá„Éï„Ç©„É´„ÉàÂÄ§„Å®„Åó„Å¶Ë®≠ÂÆö
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('quitDate').value = now.toISOString().slice(0, 16);
        });

        // URL„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„Åã„ÇâÁ¶ÅÁÖô„Éá„Éº„Çø„ÇíË™≠„ÅøÂèñ„Çã
        function loadDataFromURL() {
            const params = new URLSearchParams(window.location.search);

            if (params.has('quitDate') && params.has('cigarettesPerDay') &&
                params.has('pricePerPack') && params.has('cigarettesPerPack')) {

                const cigarettesPerDay = parseInt(params.get('cigarettesPerDay'));
                const pricePerPack = parseInt(params.get('pricePerPack'));
                const cigarettesPerPack = parseInt(params.get('cigarettesPerPack'));

                return {
                    quitDate: params.get('quitDate'),
                    cigarettesPerDay,
                    pricePerPack,
                    cigarettesPerPack,
                    pricePerCigarette: pricePerPack / cigarettesPerPack
                };
            }

            return null;
        }

        // ÂÖ±ÊúâÁî®URL„ÇíÁîüÊàê
        function generateShareURL() {
            if (!quitData) return null;

            const baseURL = window.location.origin + window.location.pathname;
            const params = new URLSearchParams({
                quitDate: quitData.quitDate,
                cigarettesPerDay: quitData.cigarettesPerDay,
                pricePerPack: quitData.pricePerPack,
                cigarettesPerPack: quitData.cigarettesPerPack
            });

            return `${baseURL}?${params.toString()}`;
        }

        // ÂÖ±ÊúâURL„Çí„Ç≥„Éî„Éº
        function copyShareURL() {
            const shareURL = generateShareURL();
            if (!shareURL) return;

            navigator.clipboard.writeText(shareURL).then(() => {
                const btn = document.getElementById('shareBtn');
                const originalText = btn.textContent;
                btn.textContent = '‚úì URL„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ';
                btn.style.background = 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('URL„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + err);
            });
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            document.getElementById('setupForm').addEventListener('submit', handleSetup);
            document.getElementById('resetBtn').addEventListener('click', handleReset);
            document.getElementById('shareBtn').addEventListener('click', copyShareURL);

            // Ê∏áÊúõË®òÈå≤Èñ¢ÈÄ£
            document.getElementById('cravingFab').addEventListener('click', openCravingModal);
            document.getElementById('closeCravingModal').addEventListener('click', closeCravingModal);
            document.getElementById('cravingModal').addEventListener('click', function(e) {
                if (e.target.id === 'cravingModal') {
                    closeCravingModal();
                }
            });
            document.getElementById('cravingForm').addEventListener('submit', handleCravingSubmit);
            document.getElementById('intensitySlider').addEventListener('input', function(e) {
                document.getElementById('intensityValue').textContent = e.target.value;
            });

            // ÂØæÂá¶Ê≥ï„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éº„Éï„Ç£„É´„Çø„Éº
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentStrategyFilter = this.dataset.category;
                    displayCopingStrategies();
                });
            });

            // SOSÈñ¢ÈÄ£
            document.getElementById('sosButton').addEventListener('click', openSOS);
            document.getElementById('sosOvercomeBtn').addEventListener('click', closeSOS);
        }

        // „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„Éï„Ç©„Éº„É†„ÅÆÂá¶ÁêÜ
        function handleSetup(e) {
            e.preventDefault();

            const quitDate = new Date(document.getElementById('quitDate').value);
            const cigarettesPerDay = parseInt(document.getElementById('cigarettesPerDay').value);
            const pricePerPack = parseInt(document.getElementById('pricePerPack').value);
            const cigarettesPerPack = parseInt(document.getElementById('cigarettesPerPack').value);

            quitData = {
                quitDate: quitDate.toISOString(),
                cigarettesPerDay,
                pricePerPack,
                cigarettesPerPack,
                pricePerCigarette: pricePerPack / cigarettesPerPack
            };

            saveData();
            showDashboard();
            startUpdating();
        }

        // „É™„Çª„ÉÉ„ÉàÂá¶ÁêÜ
        function handleReset() {
            if (confirm('Êú¨ÂΩì„Å´„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü„Åì„Çå„Åæ„Åß„ÅÆË®òÈå≤„ÅØÂÖ®„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ')) {
                localStorage.removeItem('quitData');
                quitData = null;
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
                showSetup();
            }
        }

        // „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò
        function saveData() {
            localStorage.setItem('quitData', JSON.stringify(quitData));
            localStorage.setItem('calendarData', JSON.stringify(calendarData));
            localStorage.setItem('cravings', JSON.stringify(cravings));
            localStorage.setItem('copingStrategies', JSON.stringify(copingStrategies));
            localStorage.setItem('sosHistory', JSON.stringify(sosHistory));
        }

        // „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
        function loadData() {
            // „Ç´„É¨„É≥„ÉÄ„Éº„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
            const savedCalendar = localStorage.getItem('calendarData');
            if (savedCalendar) {
                calendarData = JSON.parse(savedCalendar);
            }

            // Ê∏áÊúõË®òÈå≤„ÅÆË™≠„ÅøËæº„Åø
            const savedCravings = localStorage.getItem('cravings');
            if (savedCravings) {
                cravings = JSON.parse(savedCravings);
            }

            // ÂØæÂá¶Ê≥ï„ÅÆË™≠„ÅøËæº„ÅøÔºàÂàùÂõû„ÅØ„Éá„Éï„Ç©„É´„Éà„Éá„Éº„Çø„Çí‰ΩøÁî®Ôºâ
            const savedStrategies = localStorage.getItem('copingStrategies');
            if (savedStrategies) {
                copingStrategies = JSON.parse(savedStrategies);
            } else {
                copingStrategies = [...defaultCopingStrategies];
                saveData();
            }

            // SOSÂ±•Ê≠¥„ÅÆË™≠„ÅøËæº„Åø
            const savedSosHistory = localStorage.getItem('sosHistory');
            if (savedSosHistory) {
                sosHistory = JSON.parse(savedSosHistory);
            }

            // „Åæ„ÅöURL„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const urlData = loadDataFromURL();
            if (urlData) {
                quitData = urlData;
                // URL„Åã„ÇâË™≠„ÅøËæº„Çì„Å†„Éá„Éº„Çø„ÇÇ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                saveData();
                showDashboard();
                startUpdating();
                return;
            }

            // URL„Å´„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const saved = localStorage.getItem('quitData');
            if (saved) {
                quitData = JSON.parse(saved);
                showDashboard();
                startUpdating();
            } else {
                showSetup();
            }
        }

        // „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢„ÇíË°®Á§∫
        function showSetup() {
            document.getElementById('setup').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('dashboard').style.display = 'none';
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÇíË°®Á§∫
        function showDashboard() {
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('setup').style.display = 'none';
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('cravingFab').classList.remove('hidden');
            document.getElementById('sosButton').classList.remove('hidden');
        }

        // ÂÆöÊúüÊõ¥Êñ∞„ÅÆÈñãÂßã
        function startUpdating() {
            initTodayCalendarData();
            displayCopingStrategies();
            updateDashboard();
            updateInterval = setInterval(updateDashboard, 1000);
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆÊõ¥Êñ∞
        function updateDashboard() {
            const now = new Date();
            const quitDate = new Date(quitData.quitDate);
            const diffMs = now - quitDate;

            if (diffMs < 0) {
                return; // Êú™Êù•„ÅÆÊó•‰ªò„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà
            }

            const diffMinutes = Math.floor(diffMs / 60000);
            const diffSeconds = Math.floor(diffMs / 1000);

            // ÊôÇÈñì„ÅÆË®àÁÆó
            const days = Math.floor(diffMinutes / 1440);
            const hours = Math.floor((diffMinutes % 1440) / 60);
            const minutes = diffMinutes % 60;
            const seconds = diffSeconds % 60;

            // „Çø„Ç§„Éû„ÉºË°®Á§∫„ÅÆÊõ¥Êñ∞
            document.getElementById('days').textContent = days;
            document.getElementById('hours').textContent = hours;
            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds;

            // Áµ±Ë®à„ÅÆË®àÁÆó
            const cigarettesAvoided = Math.floor((diffMinutes / 1440) * quitData.cigarettesPerDay);
            const moneySaved = Math.floor(cigarettesAvoided * quitData.pricePerCigarette);
            const lifeRegained = cigarettesAvoided * 11; // 1Êú¨„ÅÇ„Åü„Çä11ÂàÜÂØøÂëΩ„ÅåÁ∏Æ„ÇÄ„Å®„Åï„Çå„Çã

            // ÂÅ•Â∫∑„Çπ„Ç≥„Ç¢„ÅÆË®àÁÆóÔºà15Âπ¥„Åß100%Ôºâ
            const healthScore = Math.min(100, Math.floor((diffMinutes / 7884000) * 100));

            // Áµ±Ë®à„ÅÆË°®Á§∫
            document.getElementById('moneySaved').textContent = `¬•${moneySaved.toLocaleString()}`;
            document.getElementById('cigarettesAvoided').textContent = cigarettesAvoided.toLocaleString();
            document.getElementById('lifeRegained').textContent = lifeRegained.toLocaleString();
            document.getElementById('healthScore').textContent = `${healthScore}%`;

            // „Éû„Ç§„É´„Çπ„Éà„Éº„É≥„ÅÆÊõ¥Êñ∞
            updateMilestones(diffMinutes);

            // „Éê„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞
            updateBadges(diffMinutes, moneySaved);

            // ÈÄ≤Êçó„Éê„Éº„ÅÆÊõ¥Êñ∞
            updateProgress(diffMinutes);

            // „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊõ¥Êñ∞Ôºà1Êó•„Åî„Å®„Å´Â§âÊõ¥Ôºâ
            const messageIndex = days % motivationMessages.length;
            document.getElementById('motivationText').textContent = motivationMessages[messageIndex];

            // „Ç´„É¨„É≥„ÉÄ„Éº„Éí„Éº„Éà„Éû„ÉÉ„Éó„ÅÆÊõ¥Êñ∞
            updateCalendarHeatmap();

            // Ê∏áÊúõË®òÈå≤„ÅÆÊõ¥Êñ∞
            updateCravingsDisplay();
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Éí„Éº„Éà„Éû„ÉÉ„Éó„ÅÆÁîüÊàê„Å®Êõ¥Êñ∞
        function updateCalendarHeatmap() {
            const container = document.getElementById('calendarHeatmap');
            container.innerHTML = '';

            const today = new Date();
            const quitDate = new Date(quitData.quitDate);

            // 52ÈÄ±ÈñìÂàÜ„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº„ÇíÁîüÊàê
            const weeks = 52;
            const startDate = new Date(today);
            startDate.setDate(startDate.getDate() - (weeks * 7));

            for (let week = 0; week < weeks; week++) {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'calendar-week';

                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7) + day);

                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day';

                    const dateStr = formatDateStr(currentDate);
                    dayDiv.dataset.date = dateStr;

                    // Êó•‰ªò„ÅÆÁä∂ÊÖã„ÇíÂà§ÂÆö
                    if (currentDate > today) {
                        // Êú™Êù•„ÅÆÊó•‰ªò
                        dayDiv.classList.add('future');
                    } else if (currentDate < quitDate) {
                        // Á¶ÅÁÖôÈñãÂßãÂâç„ÅÆÊó•‰ªò
                        dayDiv.classList.add('future');
                    } else {
                        // Á¶ÅÁÖôÈñãÂßãÂæå„ÅÆÊó•‰ªò
                        const dayData = calendarData[dateStr];
                        if (dayData) {
                            if (dayData.status === 'slip') {
                                dayDiv.classList.add('slip');
                            } else if (dayData.cravingCount > 0) {
                                dayDiv.classList.add('has-craving');
                            } else {
                                dayDiv.classList.add('success-perfect');
                            }
                        } else {
                            // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÁ∂ôÁ∂ö‰∏≠„Å®„Åó„Å¶Êâ±„ÅÜ
                            dayDiv.classList.add('success-light');
                        }
                    }

                    // „Éõ„Éê„ÉºÊôÇ„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó
                    dayDiv.addEventListener('mouseenter', function(e) {
                        showCalendarTooltip(e, currentDate, dateStr);
                    });

                    dayDiv.addEventListener('mouseleave', function() {
                        hideCalendarTooltip();
                    });

                    weekDiv.appendChild(dayDiv);
                }

                container.appendChild(weekDiv);
            }
        }

        // Êó•‰ªò„ÇíÊñáÂ≠óÂàó„Å´„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÔºàYYYY-MM-DDÔºâ
        function formatDateStr(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆË°®Á§∫
        function showCalendarTooltip(event, date, dateStr) {
            const tooltip = document.getElementById('calendarTooltip');
            const dayData = calendarData[dateStr];
            const today = new Date();
            const quitDate = new Date(quitData.quitDate);

            let content = '';

            if (date > today) {
                content = `${dateStr}<br>Êú™Âà∞ÈÅî`;
            } else if (date < quitDate) {
                content = `${dateStr}<br>Á¶ÅÁÖôÈñãÂßãÂâç`;
            } else {
                const daysDiff = Math.floor((date - quitDate) / (1000 * 60 * 60 * 24)) + 1;
                content = `${dateStr}<br>Á¶ÅÁÖô${daysDiff}Êó•ÁõÆ`;

                if (dayData) {
                    if (dayData.status === 'slip') {
                        content += '<br>‚ùå „Çπ„É™„ÉÉ„Éó';
                    } else if (dayData.cravingCount > 0) {
                        content += `<br>‚ö†Ô∏è Ê∏áÊúõ${dayData.cravingCount}Âõû`;
                    } else {
                        content += '<br>‚úì ÂÆåÁíß„Å™1Êó•';
                    }
                    if (dayData.notes) {
                        content += `<br>${dayData.notes}`;
                    }
                } else {
                    content += '<br>‚úì Á¶ÅÁÖôÁ∂ôÁ∂ö‰∏≠';
                }
            }

            tooltip.innerHTML = content;
            tooltip.style.display = 'block';

            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = (rect.left + window.scrollX) + 'px';
            tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆÈùûË°®Á§∫
        function hideCalendarTooltip() {
            const tooltip = document.getElementById('calendarTooltip');
            tooltip.style.display = 'none';
        }

        // ‰ªäÊó•„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº„Éá„Éº„Çø„ÇíÂàùÊúüÂåñÔºà„Åæ„Å†Â≠òÂú®„Åó„Å™„ÅÑÂ†¥ÂêàÔºâ
        function initTodayCalendarData() {
            const today = formatDateStr(new Date());
            if (!calendarData[today]) {
                calendarData[today] = {
                    status: 'success',
                    cravingCount: 0,
                    notes: ''
                };
                saveData();
            }
        }

        // Ê∏áÊúõË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openCravingModal() {
            document.getElementById('cravingModal').classList.add('active');
            document.getElementById('intensitySlider').value = 5;
            document.getElementById('intensityValue').textContent = 5;
        }

        // Ê∏áÊúõË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeCravingModal() {
            document.getElementById('cravingModal').classList.remove('active');
            document.getElementById('cravingForm').reset();
        }

        // Ê∏áÊúõË®òÈå≤„Éï„Ç©„Éº„É†„ÅÆÈÄÅ‰ø°Âá¶ÁêÜ
        function handleCravingSubmit(e) {
            e.preventDefault();

            const intensity = parseInt(document.getElementById('intensitySlider').value);
            const situation = document.querySelector('input[name="situation"]:checked').value;
            const trigger = document.getElementById('cravingTrigger').value;
            const notes = document.getElementById('cravingNotes').value;

            const craving = {
                id: new Date().getTime().toString(),
                timestamp: new Date().toISOString(),
                intensity: intensity,
                situation: situation,
                trigger: trigger,
                copingMethod: '',
                notes: notes,
                resolved: false
            };

            cravings.unshift(craving);

            // ‰ªäÊó•„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
            const today = formatDateStr(new Date());
            if (calendarData[today]) {
                calendarData[today].cravingCount++;
            }

            saveData();
            closeCravingModal();
            updateCravingsDisplay();
            updateCalendarHeatmap();

            // Ê∏áÊúõË®òÈå≤Âæå„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
            alert('Ê∏áÊúõ„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü„ÄÇÊ∑±ÂëºÂê∏„Çí„Åó„Å¶„ÄÅÊ∞¥„ÇíÈ£≤„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åì„ÅÆÊÑüË¶ö„ÅØÂøÖ„ÅöÊ∂à„Åà„Åæ„Åô„ÄÇ');
        }

        // Ê∏áÊúõË®òÈå≤„ÅÆË°®Á§∫Êõ¥Êñ∞
        function updateCravingsDisplay() {
            // Áµ±Ë®àÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
            const totalCravings = cravings.length;
            const avgIntensity = totalCravings > 0
                ? (cravings.reduce((sum, c) => sum + c.intensity, 0) / totalCravings).toFixed(1)
                : 0;

            const today = formatDateStr(new Date());
            const todayCravings = cravings.filter(c => {
                const cravingDate = formatDateStr(new Date(c.timestamp));
                return cravingDate === today;
            }).length;

            document.getElementById('totalCravings').textContent = totalCravings;
            document.getElementById('avgIntensity').textContent = avgIntensity;
            document.getElementById('todayCravings').textContent = todayCravings;

            // Ê∏áÊúõË®òÈå≤‰∏ÄË¶ß„ÅÆÊõ¥Êñ∞
            const listContainer = document.getElementById('cravingsList');
            listContainer.innerHTML = '';

            if (cravings.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">„Åæ„Å†Ê∏áÊúõË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            // ÊúÄÊñ∞10‰ª∂„ÇíË°®Á§∫
            const recentCravings = cravings.slice(0, 10);
            recentCravings.forEach(craving => {
                const div = document.createElement('div');
                div.className = 'craving-item';

                const date = new Date(craving.timestamp);
                const timeStr = date.toLocaleString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                div.innerHTML = `
                    <div class="craving-header">
                        <div class="craving-time">${timeStr}</div>
                        <div class="craving-intensity">Âº∑Â∫¶: ${craving.intensity}/10</div>
                    </div>
                    <div class="craving-details">
                        <strong>Áä∂Ê≥Å:</strong> ${craving.situation}<br>
                        ${craving.trigger ? `<strong>„Éà„É™„Ç¨„Éº:</strong> ${craving.trigger}<br>` : ''}
                        ${craving.notes ? `<strong>„É°„É¢:</strong> ${craving.notes}` : ''}
                    </div>
                `;

                listContainer.appendChild(div);
            });
        }

        // ÂØæÂá¶Ê≥ï„ÅÆË°®Á§∫
        function displayCopingStrategies() {
            const container = document.getElementById('strategyGrid');
            container.innerHTML = '';

            let filteredStrategies = copingStrategies;

            if (currentStrategyFilter === 'favorite') {
                filteredStrategies = copingStrategies.filter(s => s.favorite);
            } else if (currentStrategyFilter !== 'all') {
                filteredStrategies = copingStrategies.filter(s => s.category === currentStrategyFilter);
            }

            if (filteredStrategies.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px; grid-column: 1/-1;">Ë©≤ÂΩì„Åô„ÇãÂØæÂá¶Ê≥ï„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            filteredStrategies.forEach(strategy => {
                const div = document.createElement('div');
                div.className = 'strategy-item';

                const favoriteClass = strategy.favorite ? 'active' : '';

                div.innerHTML = `
                    <div class="strategy-header">
                        <div class="strategy-emoji">${strategy.emoji}</div>
                        <button class="strategy-favorite ${favoriteClass}" data-id="${strategy.id}">‚≠ê</button>
                    </div>
                    <div class="strategy-name">${strategy.name}</div>
                    <div class="strategy-duration">‚è±Ô∏è ${strategy.duration}</div>
                    <div class="strategy-description">${strategy.description}</div>
                    <div class="strategy-stats">
                        <span>‰ΩøÁî®ÂõûÊï∞: ${strategy.timesUsed}</span>
                    </div>
                    <button class="strategy-use-btn" data-id="${strategy.id}">„Åì„ÅÆÂØæÂá¶Ê≥ï„ÇíË©¶„Åô</button>
                `;

                container.appendChild(div);
            });

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆËøΩÂä†
            container.querySelectorAll('.strategy-favorite').forEach(btn => {
                btn.addEventListener('click', function() {
                    toggleStrategyFavorite(this.dataset.id);
                });
            });

            container.querySelectorAll('.strategy-use-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    useStrategy(this.dataset.id);
                });
            });
        }

        // ÂØæÂá¶Ê≥ï„ÅÆ„ÅäÊ∞ó„Å´ÂÖ•„Çä„Éà„Ç∞„É´
        function toggleStrategyFavorite(id) {
            const strategy = copingStrategies.find(s => s.id === id);
            if (strategy) {
                strategy.favorite = !strategy.favorite;
                saveData();
                displayCopingStrategies();
            }
        }

        // ÂØæÂá¶Ê≥ï„Çí‰ΩøÁî®
        function useStrategy(id) {
            const strategy = copingStrategies.find(s => s.id === id);
            if (strategy) {
                strategy.timesUsed++;
                saveData();
                displayCopingStrategies();
                alert(`„Äå${strategy.name}„Äç„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ${strategy.duration}„Åã„Åã„Çä„Åæ„Åô„ÄÇ\n\n${strategy.description}`);
            }
        }

        // SOSÁîªÈù¢„ÇíÈñã„Åè
        function openSOS() {
            const now = new Date();
            const quitDate = new Date(quitData.quitDate);
            const diffMs = now - quitDate;
            const diffMinutes = Math.floor(diffMs / 60000);
            const days = Math.floor(diffMinutes / 1440);

            const cigarettesAvoided = Math.floor((diffMinutes / 1440) * quitData.cigarettesPerDay);
            const moneySaved = Math.floor(cigarettesAvoided * quitData.pricePerCigarette);

            // „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆË®≠ÂÆö
            document.getElementById('sosMessage').innerHTML = `
                „ÅÇ„Å™„Åü„ÅØ„Åì„Åì„Åæ„Åß<strong>${days}Êó•Èñì</strong>È†ëÂºµ„Å£„Å¶„Åç„Åæ„Åó„ÅüÔºÅ<br>
                <strong>¬•${moneySaved.toLocaleString()}</strong>„ÇÇÁØÄÁ¥Ñ„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ<br>
                <strong>${cigarettesAvoided}Êú¨</strong>„ÅÆ„Çø„Éê„Ç≥„ÇíÈÅø„Åë„Åæ„Åó„ÅüÔºÅ<br><br>
                „ÅÇ„Å®5ÂàÜ„Å†„ÅëÂæÖ„Å°„Åæ„Åó„Çá„ÅÜ„ÄÇ<br>
                „Åì„ÅÆÊÑüË¶ö„ÅØÂøÖ„ÅöÊ∂à„Åà„Åæ„Åô„ÄÇ
            `;

            // Áµ±Ë®à„ÅÆË®≠ÂÆö
            document.getElementById('sosStats').innerHTML = `
                <div class="sos-stats-item">üèÜ ${days}Êó•Èñì„ÅÆÁ∂ôÁ∂ö</div>
                <div class="sos-stats-item">üí∞ ¬•${moneySaved.toLocaleString()} ÁØÄÁ¥Ñ</div>
                <div class="sos-stats-item">üö¨ ${cigarettesAvoided}Êú¨ ÂõûÈÅø</div>
            `;

            // „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíË°®Á§∫
            document.getElementById('sosOverlay').classList.add('active');

            // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÈñãÂßãÔºà5ÂàÜÔºâ
            let remainingSeconds = 300;
            const countdownEl = document.getElementById('sosCountdown');

            if (sosCountdownInterval) {
                clearInterval(sosCountdownInterval);
            }

            sosCountdownInterval = setInterval(() => {
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                countdownEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                remainingSeconds--;

                if (remainingSeconds < 0) {
                    clearInterval(sosCountdownInterval);
                    countdownEl.textContent = 'ÊôÇÈñì„Åß„ÅôÔºÅ';
                }
            }, 1000);
        }

        // SOSÁîªÈù¢„ÇíÈñâ„Åò„Çã
        function closeSOS() {
            if (sosCountdownInterval) {
                clearInterval(sosCountdownInterval);
            }

            // ÊàêÂäü„ÇíË®òÈå≤
            sosHistory.push({
                timestamp: new Date().toISOString(),
                success: true
            });

            saveData();

            document.getElementById('sosOverlay').classList.remove('active');

            alert('Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ„ÅÇ„Å™„Åü„ÅØÊ∏áÊúõ„Çí‰πó„ÇäË∂ä„Åà„Åæ„Åó„ÅüÔºÅ„Åì„ÅÆÂãùÂà©„ÇíË™á„Çä„Å´ÊÄù„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
        }

        // „Éû„Ç§„É´„Çπ„Éà„Éº„É≥„ÅÆÊõ¥Êñ∞
        function updateMilestones(currentMinutes) {
            const milestonesContainer = document.getElementById('milestones');
            milestonesContainer.innerHTML = '';

            let nextMilestoneFound = false;

            healthMilestones.forEach(milestone => {
                const div = document.createElement('div');
                div.className = 'milestone';

                let statusText = '';
                let statusClass = '';
                let remainingText = '';

                if (currentMinutes >= milestone.minutes) {
                    div.classList.add('achieved');
                    statusText = 'ÈÅîÊàêÊ∏à„Åø ‚úì';
                    statusClass = 'milestone-status';
                } else if (!nextMilestoneFound) {
                    div.classList.add('next');
                    statusText = 'Ê¨°„ÅÆÁõÆÊ®ô ‚Üí';
                    statusClass = 'milestone-status';
                    nextMilestoneFound = true;

                    // ÊÆã„ÇäÊôÇÈñì„ÇíË®àÁÆó
                    const remainingMinutes = milestone.minutes - currentMinutes;
                    remainingText = `<div class="milestone-remaining">„ÅÇ„Å® ${formatRemainingTime(remainingMinutes)}</div>`;
                } else {
                    div.classList.add('upcoming');
                    statusText = 'Êú™ÈÅîÊàê';
                    statusClass = 'milestone-status';

                    // ÊÆã„ÇäÊôÇÈñì„ÇíË®àÁÆó
                    const remainingMinutes = milestone.minutes - currentMinutes;
                    remainingText = `<div class="milestone-remaining">„ÅÇ„Å® ${formatRemainingTime(remainingMinutes)}</div>`;
                }

                const timeText = formatMilestoneTime(milestone.minutes);

                div.innerHTML = `
                    <span class="milestone-icon">${milestone.icon}</span>
                    <div class="${statusClass}">${statusText}</div>
                    <div class="milestone-time">${timeText}</div>
                    <div class="milestone-benefit">${milestone.text}</div>
                    ${remainingText}
                `;

                milestonesContainer.appendChild(div);
            });
        }

        // ÊÆã„ÇäÊôÇÈñì„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatRemainingTime(minutes) {
            if (minutes < 60) {
                return `${minutes}ÂàÜ`;
            } else if (minutes < 1440) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return mins > 0 ? `${hours}ÊôÇÈñì${mins}ÂàÜ` : `${hours}ÊôÇÈñì`;
            } else if (minutes < 43200) {
                const days = Math.floor(minutes / 1440);
                const hours = Math.floor((minutes % 1440) / 60);
                return hours > 0 ? `${days}Êó•${hours}ÊôÇÈñì` : `${days}Êó•`;
            } else if (minutes < 525600) {
                const months = Math.floor(minutes / 43200);
                const days = Math.floor((minutes % 43200) / 1440);
                return days > 0 ? `${months}„É∂Êúà${days}Êó•` : `${months}„É∂Êúà`;
            } else {
                const years = Math.floor(minutes / 525600);
                const months = Math.floor((minutes % 525600) / 43200);
                return months > 0 ? `${years}Âπ¥${months}„É∂Êúà` : `${years}Âπ¥`;
            }
        }

        // „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÊôÇÈñì„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatMilestoneTime(minutes) {
            if (minutes < 60) {
                return `${minutes}ÂàÜ`;
            } else if (minutes < 1440) {
                return `${Math.floor(minutes / 60)}ÊôÇÈñì`;
            } else if (minutes < 43200) {
                return `${Math.floor(minutes / 1440)}Êó•`;
            } else if (minutes < 525600) {
                return `${Math.floor(minutes / 43200)}„É∂Êúà`;
            } else {
                return `${Math.floor(minutes / 525600)}Âπ¥`;
            }
        }

        // „Éê„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞
        function updateBadges(currentMinutes, moneySaved) {
            const badgesContainer = document.getElementById('badges');
            badgesContainer.innerHTML = '';

            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = 'badge';

                let earned = false;
                if (achievement.condition === 'money') {
                    earned = moneySaved >= achievement.threshold;
                } else {
                    earned = currentMinutes >= achievement.minutes;
                }

                if (earned) {
                    div.classList.add('earned');
                }

                div.innerHTML = `
                    <div class="badge-icon">${achievement.icon}</div>
                    <div class="badge-name">${achievement.name}</div>
                `;

                badgesContainer.appendChild(div);
            });
        }

        // ÈÄ≤Êçó„Éê„Éº„ÅÆÊõ¥Êñ∞
        function updateProgress(currentMinutes) {
            // 1ÈÄ±ÈñìÔºà10080ÂàÜÔºâ
            const week1Percent = Math.min(100, Math.floor((currentMinutes / 10080) * 100));
            document.getElementById('week1Progress').textContent = `${week1Percent}%`;
            document.getElementById('week1Bar').style.width = `${week1Percent}%`;
            document.getElementById('week1Bar').textContent = week1Percent > 0 ? `${week1Percent}%` : '';

            // 1„É∂ÊúàÔºà43200ÂàÜÔºâ
            const month1Percent = Math.min(100, Math.floor((currentMinutes / 43200) * 100));
            document.getElementById('month1Progress').textContent = `${month1Percent}%`;
            document.getElementById('month1Bar').style.width = `${month1Percent}%`;
            document.getElementById('month1Bar').textContent = month1Percent > 0 ? `${month1Percent}%` : '';

            // 1Âπ¥Ôºà525600ÂàÜÔºâ
            const year1Percent = Math.min(100, Math.floor((currentMinutes / 525600) * 100));
            document.getElementById('year1Progress').textContent = `${year1Percent}%`;
            document.getElementById('year1Bar').style.width = `${year1Percent}%`;
            document.getElementById('year1Bar').textContent = year1Percent > 0 ? `${year1Percent}%` : '';
        }
    </script>
</body>
</html>
